---
title: 'RecSys Project #4'
author: "J. Hamski, V. Nguy"
date: "July 5, 2016"
output: pdf_document
---

```{r}
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(knitr)
```


Reading in needed datasets. Artist information will be joined to user-artist dataset for readability
```{r Read_Dataset, cache=TRUE, warnings = FALSE}
user.artists.pairwise <- read_delim('hetrec2011-lastfm-2k/user_artists.dat', delim = "\t")

artists <- read_delim('hetrec2011-lastfm-2k/artists.dat', delim = "\t") %>% select(id, name)
```

#Data Preparation

Converting from Artist IDs to Artist Names for easier interpretation.
```{r join_artist_name, cache=TRUE}
colnames(artists) <- c("artistID", "name")

#note: one duplicate artist
#artists$name[duplicated(artists$name)==TRUE]
user.artists.pairwise <- inner_join(user.artists.pairwise, artists, by="artistID")

user.artists.pairwise <- select(user.artists.pairwise, -artistID)

user.artists.pairwise$name <- strtrim(user.artists.pairwise$name, 100)

user.artists.pairwise[16060,]$name <- NA

#ggplot(user.artists.pairwise, aes(x = weight)) + geom_density() + theme_bw() + scale_x_log10()
```

The user-artist pairwise record contains multiple rows for a single artist. In order to understand the distribution of listens for artists, we group and sum for each artist. 
```{r}
artist.listens <- user.artists.pairwise %>%
  group_by(name) %>% 
  summarise(total.listens = sum(weight))
```


# Exploratory Data Analysis

The median number for listens is 324 - quite  a low number! The highest number of listens is Britney Spears with 2.3 million listens. We believe this dataset could be well modeled with a lognormal distribution. 
```{r}
summary(artist.listens$total.listens)
ggplot(artist.listens, aes(x = total.listens)) + geom_density() + theme_bw() + scale_x_log10()
```

Looking at the top 10 artists it is important to note that Britney Spears has nearly twice as many listens as the next most popular artist, Depeche Mode. 
```{r}
artist.listens %>% arrange(desc(total.listens)) %>% top_n(10) %>% kable()
```

We have decided to limit our recommender system to artist who have more than 900 total listens.
```{r}
listens.cutoff <- 900
artist.cutoff <- artist.listens %>% filter(total.listens >= listens.cutoff)
```

# User-Item Matrix Construction
Using the TidyR library the pairwise data was converted into a sparse matrix.
```{r spread_data, cache=TRUE}
user.artists.matrix <- user.artists.pairwise %>%
  filter(name %in% artist.cutoff$name) %>% #filter artists with less than num_listens listens
  spread(key = name, value = weight) %>%
  distinct() %>%
  as.matrix()

rownames(user.artists.matrix) <- user.artists.matrix[,1]
user.artists <- user.artists.matrix[,-1]
dim(user.artists)
```

## NAs

We tried two ways of dealing with NAs - imputing with column averages, and replacing with 0s.Note that due to the sparsity of the dataset, for most artists the column mean rounds to zero.  
```{r}
# http://stackoverflow.com/questions/25835643/replacing-missing-values-in-r-with-column-mean
user.artists.ave <- user.artists
for(i in 1:ncol(user.artists.ave)){
  user.artists.ave[is.na(user.artists.ave[,i]), i] <- mean(user.artists.ave[,i], na.rm = TRUE)
}

user.artists[is.na(user.artists)] <- 0
```




